<h1> Welcome to Bubbles</h1>

<div id="map"></div>
<script>
    // change locationS to location
    var locations = [
        <% @dives.each do |dive| %>
        [<%= dive.latitude%>, <%= dive.longitude%>, '<%= dive.location%> ', '<%= dive.comments%> <%= link_to dive.location, controller:'dives', action:'show', diver_id: dive.diver_id, id:dive.id %>'],
        <% end %>
    ]

    function initMap() {

        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 2,
            center: {lat: locations[0][0], lng: locations[0][1]}
        });

        // Create an array of alphabetical characters used to label the markers.
        var labels = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

        // Add some markers to the map.
        // Note: The code uses the JavaScript Array.prototype.map() method to
        // create an array of markers based on a given "locations" array.
        // The map() method here has nothing to do with the Google Maps API.

        var infoWindows = locations.map(function(location){
            return new google.maps.InfoWindow({
                content: location[3] ,
                maxWidth: 200
            })
        });

        var markers = locations.map(function(location, i) {
            return new google.maps.Marker({
                position: {lat: location[0], lng: location[1]},
                title: location[2],
                label: labels[i % labels.length]
            });
        });

        markers.map(function(marker, ii){
            marker.addListener('click', function() {
                for (i = 0; i < infoWindows.length; i++) {
                    infoWindows[i].close();
                }
                infoWindows[ii].open(map, marker);
            });
        })

        // Add a marker clusterer to manage the markers.
        var markerCluster = new MarkerClusterer(map, markers,
            {imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'});
    }

</script>
<script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js">
</script>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAZuRqWqKV7OQtNH8MXE1GF1RkqrLolUDM&callback=initMap">
</script>

<% @dives.each do |dive| %>
    <div class ="dive_wrapper">
      <h2 class = "Location"> <%= link_to dive.location, controller:'dives', action:'show', diver_id: dive.diver_id, id:dive.id %></h2>
      <!-- user_link is used to create a link to the user profile -->
      <% diver_link = dive.diver.first_name + ' ' + dive.diver.last_name %>
      <p class="date"><%= dive.created_at.strftime("%B %d, %Y") %> | By: <%= link_to diver_link, controller:'divers', action: 'show', id: dive.diver_id %> </p>
      <p class = "body"> <%=dive.comments %> </p>

    </div>
<% end %>
